---
title: 配置
description: 深入了解 AutoForm 的配置体系，掌握元数据、控件属性和全局配置的使用方法。
---

## 核心类型

### ReactiveValue

AutoForm 的配置系统基于 `ReactiveValue` 类型，它支持三种值的形式：

```ts
type ReactiveValue<T, CTX = never> =
  [CTX] extends [never]
    ? MaybeRefOrGetter<T>                    // 无上下文：ref 或 getter
    : MaybeRefOrGetter<T> | ((ctx: CTX) => T) // 有上下文：ref、getter 或上下文函数
```

**三种使用形式**：

```ts
// 1. 静态值
label: '用户名'

// 2. 响应式引用（ref 或 computed）
const labelRef = ref('用户名')

// 3. 上下文函数（可访问表单状态）
label: ({ state }) => state?.userType === 'business' ? '公司名称' : '姓名'
```

### AutoFormFieldContext

上下文函数接收的参数类型：

```ts
interface AutoFormFieldContext<S = any, P extends string = string> {
  readonly state: S           // 表单完整状态
  readonly path: P            // 当前字段路径
  readonly value: any         // 当前字段值
  setValue: Function          // 设置字段值
  readonly errors: unknown[]  // 字段错误列表
  readonly loading: boolean   // 表单加载状态
}
```

**使用示例**：

```ts
afz.string().meta({
  // 根据表单状态动态显示/隐藏
  hidden: ({ state }) => state?.userType !== 'business',

  // 根据字段值动态提示
  hint: ({ value }) => value ? `已输入 ${value.length} 个字符` : '请输入',

  // 根据错误状态动态样式
  class: ({ errors }) => errors.length > 0 ? 'border-red-500' : ''
})
```

## 元数据配置

### 配置方式

使用 `.meta()` 方法配置字段的 UI 属性：

```ts
afz.string()
  .min(3, '用户名至少 3 个字符')
  .meta({
    label: '用户名',
    description: '请输入您的用户名',
    hint: '3-20 个字符',
    required: true
  })
```

### 可用属性

| 属性 | 类型 | 说明 |
|------|------|------|
| `label` | `ReactiveValue<string>`{lang="ts-type"} | 字段标签 |
| `description` | `ReactiveValue<string>`{lang="ts-type"} | 字段描述 |
| `hint` | `ReactiveValue<string>`{lang="ts-type"} | 提示信息 |
| `help` | `ReactiveValue<string>`{lang="ts-type"} | 帮助文本 |
| `error` | `ReactiveValue<boolean \| string>`{lang="ts-type"} | 自定义错误信息 |
| `required` | `ReactiveValue<boolean>`{lang="ts-type"} | 标记字段为必填 |
| `size` | `ReactiveValue<'xs' \| 'sm' \| 'md' \| 'lg' \| 'xl'>`{lang="ts-type"} | 字段大小 |
| `as` | `ReactiveValue<any>`{lang="ts-type"} | 渲染的元素或组件类型 |
| `name` | `ReactiveValue<string>`{lang="ts-type"} | 字段名称,用于匹配表单错误 |
| `errorPattern` | `ReactiveValue<RegExp>`{lang="ts-type"} | 正则表达式,用于匹配表单错误名称 |
| `if` | `ReactiveValue<boolean>`{lang="ts-type"} | 条件渲染 |
| `hidden` | `ReactiveValue<boolean>`{lang="ts-type"} | 隐藏字段 |
| `eagerValidation` | `ReactiveValue<boolean>`{lang="ts-type"} | 启用立即验证 |
| `validateOnInputDelay` | `ReactiveValue<number>`{lang="ts-type"} | 输入验证延迟 |
| `class` | `ReactiveValue<ClassNameValue>`{lang="ts-type"} | 自定义 CSS 类名 |
| `ui` | `ReactiveValue<Record<string, any>>`{lang="ts-type"} | Nuxt UI 样式自定义对象 |
| `collapsible` | `ReactiveValue<AutoFormNestedCollapsible>`{lang="ts-type"} | 嵌套字段折叠配置 |
| `fieldSlots` | `ReactiveValue<Partial<AutoFormFieldSlots>>`{lang="ts-type"} | 字段插槽内容 |

### 配置优先级

AutoForm 按以下优先级合并配置（从低到高）：

1. **自动默认值** - 系统根据字段类型自动生成
   - `label` - 根据字段名生成（`userName` → `"User Name"`）
   - `required` - 根据 `.optional()` 自动判断

2. **全局配置** (`globalMeta`) - 统一配置所有字段

3. **字段级配置** (`.meta()`) - 针对特定字段的配置

::note
**优先级示例**：如果全局设置 `size: 'lg'`，字段设置 `size: 'md'`，最终生效的是 `'md'`。
::

## 控件配置

### AutoFormControlsMeta

控件配置支持以下属性：

```ts
interface AutoFormControlsMeta<C extends IsComponent = IsComponent> {
  type?: string                                    // 控件类型名称
  component?: C                                    // 直接传入组件
  controlProps?: ReactiveValue<ComponentProps<C>> // 控件属性
  controlSlots?: ReactiveValue<ComponentSlots<C>> // 控件插槽
  error?: string                                   // 验证错误消息
}
```

### 使用方式

**方式 1：使用 type 指定控件**

```ts
afz.string({
  type: 'textarea',
  controlProps: {
    rows: 5,
    placeholder: '请输入...'
  }
})
```

**方式 2：直接传入组件**

```ts
import CustomComponent from './CustomComponent.vue'

afz.number({
  component: CustomComponent,
  controlProps: {
    max: 5,
    size: 'lg'
  }
})
```

**方式 3：响应式控件配置**

```ts
afz.string({
  // 响应式属性
  controlProps: ({ state }) => ({
    disabled: state?.readonly === true,
    placeholder: state?.userType === 'business' ? '公司邮箱' : '个人邮箱'
  }),

  // 响应式插槽
  controlSlots: ({ value }) => ({
    trailing: () => h(UBadge, { label: `${value?.length || 0}` })
  })
})
```

### 简写语法

支持直接传入字符串作为错误消息：

```ts
// 完整写法
afz.email({ error: '请输入有效的邮箱地址' })

// 简写形式
afz.email('请输入有效的邮箱地址')
```

## 全局配置

### globalMeta 属性

通过 `AutoForm` 组件的 `globalMeta` prop 统一配置所有字段：

```vue
<MAutoForm
  :schema="schema"
  :state="form"
  :global-meta="{
    size: 'lg',
    required: true,
    validateOnInputDelay: 300
  }"
/>
```

### app.config.ts 全局样式

通过 `app.config.ts` 全局配置表单样式：

```ts [app.config.ts]
export default defineAppConfig({
  ui: {
    form: {
      base: 'space-y-4 min-w-md'
    },
    collapsible: {
      slots: {
        content: 'space-y-4'
      }
    }
  }
})
```

## 控件类型映射

### 默认映射

| afz 方法 | 默认控件 | 说明 |
|----------|----------|------|
| `afz.string()` | `UInput`{lang="ts-type"} | 文本输入框 |
| `afz.number()` | `UInputNumber`{lang="ts-type"} | 数字输入框 |
| `afz.boolean()` | `UCheckbox`{lang="ts-type"} | 复选框 |
| `afz.enum()` | `USelect`{lang="ts-type"} | 下拉选择器 |
| `afz.file()` | `UFileUpload`{lang="ts-type"} | 文件上传 |
| `afz.date()` | `DatePicker`{lang="ts-type"} | 日期选择器 |

### 可用的 type 值

| type 值 | 控件组件 |
|---------|---------|
| `textarea` | `UTextarea`{lang="ts-type"} |
| `switch` | `USwitch`{lang="ts-type"} |
| `slider` | `USlider`{lang="ts-type"} |
| `pinInput` | `UPinInput`{lang="ts-type"} |
| `inputTags` | `UInputTags`{lang="ts-type"} |
| `selectMenu` | `USelectMenu`{lang="ts-type"} |
| `inputMenu` | `UInputMenu`{lang="ts-type"} |
| `checkboxGroup` | `UCheckboxGroup`{lang="ts-type"} |
| `radioGroup` | `URadioGroup`{lang="ts-type"} |
| `withClear` | `WithClear`{lang="ts-type"} |
| `withPasswordToggle` | `WithPasswordToggle`{lang="ts-type"} |
| `withCopy` | `WithCopy`{lang="ts-type"} |
| `withCharacterLimit` | `WithCharacterLimit`{lang="ts-type"} |
| `colorChooser` | `ColorChooser`{lang="ts-type"} |
| `starRating` | `StarRating`{lang="ts-type"} |
