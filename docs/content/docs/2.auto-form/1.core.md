---
title: Core
description: 了解 AutoForm 的核心设计理念和基本使用方式
---

## 概述

AutoForm 是一个基于 Zod Schema 的自动表单生成系统。通过声明式的 Schema 定义，自动生成完整的表单界面，包括输入控件、验证规则和布局结构。

::callout{icon="i-lucide-lightbulb" color="primary"}
**核心优势**
- **Schema 即表单** - 一份 Schema 同时定义数据结构、验证规则和 UI 配置
- **类型安全** - 完整的 TypeScript 类型推断，从 Schema 到表单数据
- **零模板代码** - 无需手写 `v-for` 或重复的表单字段模板
::

## Schema 定义

`useAutoForm` 返回核心对象 `afz`（AutoForm Zod），它是 [Zod](https://zod.dev/) 的增强版封装。

```ts
const { afz } = useAutoForm()

const schema = afz.object({
  username: afz.string().min(3),
  email: afz.email(),
  age: afz.number().min(18)
})
```

::warning

为什么使用 afz 而不是原生 z？

`afz` 代理了 Zod 的方法，自动拦截并注入 AutoForm 元数据。这确保了：

1. **元数据传递** - UI 配置（如 `label`、`placeholder`）能正确传递给表单组件
2. **链式调用保留** - 调用 `.optional()`、`.default()` 等方法时元数据不会丢失
3. **控件映射** - 自动将 Zod 类型映射到对应的 UI 控件

  ::code-group
  ```ts [✅ 正确用法]
  // 使用 afz，元数据完整传递
  const schema = afz.object({
    username: afz.string().meta({ label: '用户名' }).optional()
  })
  ```

  ```ts [⚠️ 不推荐]
  // 原生 Zod 可能丢失 UI 配置
  import { z } from 'zod/v4'
  const schema = z.object({
    username: z.string() // 无法配置 label、placeholder 等
  })
  ```
  ::

::

## 控件映射

AutoForm 根据 Zod 类型自动选择对应的 UI 控件，也可以通过 `.meta({ type: 'xxx' })` 手动指定控件类型。

**默认映射规则**：

| afz 方法 | 默认控件 | 说明 |
|----------|----------|------|
| `afz.string()`{lang="ts-type"} | `UInput` | 文本输入框 |
| `afz.number()`{lang="ts-type"} | `UInputNumber` | 数字输入框 |
| `afz.boolean()`{lang="ts-type"} | `UCheckbox` | 复选框 |
| `afz.enum()`{lang="ts-type"} | `USelect` | 下拉选择器 |
| `afz.file()`{lang="ts-type"} | `UFileUpload` | 文件上传 |
| `afz.date()`{lang="ts-type"} | `DatePicker` | 日期选择器 |

**可用的 type 控件类型**：

| type 值 | 控件组件 | 说明 |
|--------|---------|------|
| `textarea`{lang="ts-type"} | `UTextarea` | 多行文本输入框 |
| `switch`{lang="ts-type"} | `USwitch` | 开关组件 |
| `slider`{lang="ts-type"} | `USlider` | 滑块（用于范围选择） |
| `pinInput`{lang="ts-type"} | `UPinInput` | 密码输入框（固定位数输入） |
| `inputTags`{lang="ts-type"} | `UInputTags` | 标签输入框 |
| `selectMenu`{lang="ts-type"} | `USelectMenu` | 可搜索的选择菜单 |
| `inputMenu`{lang="ts-type"} | `UInputMenu` | 带输入功能的下拉菜单 |
| `checkboxGroup`{lang="ts-type"} | `UCheckboxGroup` | 复选框组 |
| `radioGroup`{lang="ts-type"} | `URadioGroup` | 单选框组 |
| `withClear`{lang="ts-type"} | `WithClear` | 带清除按钮的输入框 |
| `withPasswordToggle`{lang="ts-type"} | `WithPasswordToggle` | 带密码切换的输入框 |
| `withCopy`{lang="ts-type"} | `WithCopy` | 带复制按钮的输入框 |
| `withCharacterLimit`{lang="ts-type"} | `WithCharacterLimit` | 带字符限制的输入框 |
| `colorChooser`{lang="ts-type"} | `ColorChooser` | 颜色选择器 |
| `starRating`{lang="ts-type"} | `StarRating` | 星级评分组件 |

## 配置

### 元数据属性

使用 `.meta()` 方法配置字段的 UI 属性，这些属性与 [Nuxt UI FormField](https://ui.nuxt.com/docs/components/form-field#props) 保持一致：

```ts
const { afz } = useAutoForm()

const schema = afz.object({
  username: afz.string()
    .min(3, '用户名至少 3 个字符')
    .meta({
      label: '用户名',
      description: '请输入您的用户名',
      hint: '3-20 个字符',
      placeholder: '请输入',
      required: true
    })
})
```

### 默认值与合并逻辑

AutoForm 会自动为字段设置默认的元数据，并按以下优先级合并配置：

**1. 自动生成的默认值**（优先级最低）
- `label`：根据字段名自动生成（如 `userName` → `"User Name"`）
- `required`：根据 `.optional()` 自动判断（非可选字段默认为 `true`）
- `description`：从 Zod 的 `.describe()` 提取（已废弃，建议使用 `.meta({ description: '...' })`）

**2. 全局配置** - 通过 `MAutoForm` 组件的 `fieldOptions` prop 统一配置
```ts
<MAutoForm
  :schema="schema"
  :global-meta="{ size: 'lg', class: 'custom-field' }"
/>
```

**3. 字段级配置** - 通过 `.meta()` 方法自定义（优先级最高）
```ts
afz.string().meta({
  label: '自定义标签',  // 覆盖自动生成的 label
  required: false       // 覆盖自动判断的 required
})
```

::note
**合并优先级**：自动默认值 < 全局配置 < 字段级配置

示例：如果全局设置 `size: 'lg'`，字段设置 `size: 'md'`，最终生效的是 `'md'`。
::

**常用属性**：

| 属性 | 类型 | 说明 |
|------|------|------|
| `label`{lang="ts-type"} | `string` | 字段标签 |
| `description`{lang="ts-type"} | `string` | 字段描述（显示在标签下方） |
| `hint`{lang="ts-type"} | `string` | 提示信息（显示在输入框右上角） |
| `placeholder`{lang="ts-type"} | `string` | 占位符文本 |
| `help`{lang="ts-type"} | `string` | 帮助文本（显示在输入框下方） |
| `required`{lang="ts-type"} | `boolean` | 标记字段为必填（在 label 旁显示星号） |
| `type`{lang="ts-type"} | `string` | 指定控件类型（覆盖默认映射） |
| `size`{lang="ts-type"} | `'xs' \| 'sm' \| 'md' \| 'lg' \| 'xl'` | 字段大小（默认：`'md'`） |

::collapsible{name="查看所有可用属性"}
| 属性 | 类型 | 说明 |
|------|------|------|
| `as`{lang="ts-type"} | `string` | 渲染为指定的 HTML 元素或组件（默认：`'div'`） |
| `label`{lang="ts-type"} | `string` | 字段标签 |
| `description`{lang="ts-type"} | `string` | 字段描述（显示在标签下方） |
| `hint`{lang="ts-type"} | `string` | 提示信息（显示在输入框右上角） |
| `placeholder`{lang="ts-type"} | `string` | 占位符文本 |
| `help`{lang="ts-type"} | `string` | 帮助文本（显示在输入框下方） |
| `error`{lang="ts-type"} | `string` | 错误信息（当验证失败时显示） |
| `required`{lang="ts-type"} | `boolean` | 标记字段为必填（在 label 旁显示星号） |
| `size`{lang="ts-type"} | `'xs' \| 'sm' \| 'md' \| 'lg' \| 'xl'` | 字段大小（默认：`'md'`） |
| `type`{lang="ts-type"} | `string` | 指定控件类型（覆盖默认映射），支持自动完成 |
| `if`{lang="ts-type"} | `boolean \| (context) => boolean` | 条件渲染，支持动态函数 |
| `hidden`{lang="ts-type"} | `boolean \| (context) => boolean` | 隐藏字段，支持动态函数 |
| `name`{lang="ts-type"} | `string` | 字段名称，用于匹配表单错误 |
| `errorPattern`{lang="ts-type"} | `RegExp` | 正则表达式，用于匹配表单错误名称 |
| `eagerValidation`{lang="ts-type"} | `boolean` | 启用立即验证（默认在 blur 事件时验证） |
| `validateOnInputDelay`{lang="ts-type"} | `number` | 输入事件后的验证延迟（毫秒，默认：`300`） |
| `class`{lang="ts-type"} | `string \| Record<string, any>` | 自定义 CSS 类名 |
| `ui`{lang="ts-type"} | `Record<string, any>` | Nuxt UI 样式自定义对象 |
::

### 控件配置

使用 `controlProps` 直接配置底层控件的属性，享受完整的类型推导和自动补全：

```ts
const schema = afz.object({
  email: afz.string({
    controlProps: {
      // UInput 组件的所有属性都会被提示
      leadingIcon: 'i-lucide-at-sign',
      placeholder: 'example@email.com'
    }
  }),

  bio: afz.string({
    type: 'textarea',
    controlProps: {
      // 编辑器会提示 UTextarea 的所有属性
      rows: 5,
      maxlength: 500
    }
  }),

  rating: afz.number({
    type: 'starRating',
    controlProps: {
      // 自动提示 StarRating 组件的属性
      max: 5,
      size: 'lg'
    }
  })
})
```

### 简写语法

支持直接传入字符串作为错误消息的简写形式：

```ts
const schema = afz.object({
  // 完整写法
  username: afz.string({ error: '请输入用户名' }),

  // 简写形式
  email: afz.email('请输入有效的邮箱地址')
})
```
