---
title: 核心概念
description: 了解 AutoForm 的核心设计理念和基本使用方式
---

## 概述

AutoForm 是一个基于 Zod Schema 的自动表单生成系统。通过声明式的 Schema 定义，自动生成完整的表单界面，包括输入控件、验证规则和布局结构。

::callout{icon="i-lucide-lightbulb" color="primary"}
**核心优势**
- **Schema 即表单** - 一份 Schema 同时定义数据结构、验证规则和 UI 配置
- **类型安全** - 完整的 TypeScript 类型推断，从 Schema 到表单数据
- **零模板代码** - 无需手写 `v-for` 或重复的表单字段模板
::

## Schema 定义

### useAutoForm 组合式函数

`useAutoForm` 返回核心对象 `afz`（AutoForm Zod），它是 [Zod](https://zod.dev/) 的增强版封装。

```ts
const { afz } = useAutoForm()

const schema = afz.object({
  username: afz.string().min(3),
  email: afz.email(),
  age: afz.number().min(18)
})
```

::warning{icon="i-lucide-alert-triangle"}

为什么使用 afz 而不是原生 z？

`afz` 代理了 Zod 的方法，自动拦截并注入 AutoForm 元数据。这确保了：

1. **元数据传递** - UI 配置（如 `label`、`placeholder`）能正确传递给表单组件
2. **链式调用保留** - 调用 `.optional()`、`.default()` 等方法时元数据不会丢失
3. **控件映射** - 自动将 Zod 类型映射到对应的 UI 控件

  ::code-group
  ```ts [✅ 正确用法]
  // 使用 afz，元数据完整传递
  const schema = afz.object({
    username: afz.string().meta({ label: '用户名' }).optional()
  })
  ```

  ```ts [⚠️ 不推荐]
  // 原生 Zod 可能丢失 UI 配置
  import { z } from 'zod/v4'
  const schema = z.object({
    username: z.string() // 无法配置 label、placeholder 等
  })
  ```
  ::

::

### 默认控件映射

根据字段的 Zod 类型自动选择对应的 UI 控件。你也可以通过 `type` 属性指定其他控件类型。

**基础类型**：

| afz 方法 | 默认控件 | 说明 |
|----------|----------|------|
| `afz.string()` | `UInput` | 文本输入框 |
| `afz.number()` | `UInputNumber` | 数字输入框 |
| `afz.boolean()` | `UCheckbox` | 复选框 |
| `afz.enum()` | `USelect` | 下拉选择器 |
| `afz.file()` | `UFileUpload` | 文件上传 |
| `afz.date()` | `DatePicker` | 日期选择器 |

**自定义类型**（通过 `type: 'xxx'` 指定）：

| type 值 | 控件 | 说明 |
|--------|------|------|
| `'switch'` | `USwitch` | 开关组件 |
| `'textarea'` | `UTextarea` | 多行文本输入框 |
| `'slider'` | `USlider` | 滑块（用于范围选择） |
| `'pinInput'` | `UPinInput` | 密码输入框（固定位数输入） |
| `'inputTags'` | `UInputTags` | 标签输入框 |
| `'selectMenu'` | `USelectMenu` | 可搜索的选择菜单 |
| `'inputMenu'` | `UInputMenu` | 带输入功能的下拉菜单 |
| `'checkboxGroup'` | `UCheckboxGroup` | 复选框组 |
| `'radioGroup'` | `URadioGroup` | 单选框组 |

**增强型输入框**：

| type 值 | 控件 | 说明 |
|--------|------|------|
| `'withClear'` | `WithClear` | 带清除按钮的输入框 |
| `'withPasswordToggle'` | `WithPasswordToggle` | 带密码切换的输入框 |
| `'withCopy'` | `WithCopy` | 带复制按钮的输入框 |
| `'withCharacterLimit'` | `WithCharacterLimit` | 带字符限制的输入框 |

**特殊组件**：

| type 值 | 控件 | 说明 |
|--------|------|------|
| `'colorChooser'` | `ColorChooser` | 颜色选择器 |
| `'starRating'` | `StarRating` | 星级评分组件 |

## 元数据配置

### .meta() 方法

所有属性都有完整的 TypeScript 类型定义，编辑器会自动提示。这些属性与 [Nuxt UI FormField 组件](https://ui.nuxt.com/docs/components/form-field#props) 保持一致：

```ts
const { afz } = useAutoForm()

const schema = afz.object({
  username: afz.string()
    .min(3, '用户名至少 3 个字符')
    .meta({
      label: '用户名',
      description: '请输入您的用户名',
      hint: '3-20 个字符',
      placeholder: '请输入'
    })
})
```

::collapsible{name="全部可用属性" openText="展开" closeText="收起"}
| 属性 | 说明 |
|------|------|
| `as` | 渲染为指定的 HTML 元素或组件（默认：`'div'`） |
| `label` | 字段标签 |
| `description` | 字段描述（显示在标签下方） |
| `hint` | 提示信息（显示在输入框右上角） |
| `placeholder` | 占位符文本 |
| `help` | 帮助文本（显示在输入框下方） |
| `error` | 错误信息（当验证失败时显示） |
| `required` | 标记字段为必填（在 label 旁显示星号） |
| `size` | 字段大小（`xs` \| `sm` \| `md` \| `lg` \| `xl`，默认：`'md'`） |
| `type` | 指定控件类型（覆盖默认映射），支持自动完成 |
| `if` | 条件渲染，支持动态函数 |
| `hidden` | 隐藏字段，支持动态函数 |
| `name` | 字段名称，用于匹配表单错误 |
| `errorPattern` | 正则表达式，用于匹配表单错误名称 |
| `eagerValidation` | 启用立即验证（默认在 blur 事件时验证） |
| `validateOnInputDelay` | 输入事件后的验证延迟（毫秒，默认：`300`） |
| `class` | 自定义 CSS 类名 |
| `ui` | Nuxt UI 样式自定义对象 |
::

::note{to="https://ui.nuxt.com/docs/components/form-field"}
更多 FormField 相关的属性和配置选项，可参考 Nuxt UI FormField 文档。
::

### 控件属性配置

使用 `controlProps` 直接配置控件的属性。当指定 `type` 时，`controlProps` 的类型会自动调整，编辑器会根据控件类型提示可用属性：

```ts
const schema = afz.object({
  email: afz.string({
    controlProps: {
      leadingIcon: 'i-lucide-at-sign',
      placeholder: 'example@email.com'
    }
  }),

  bio: afz.string({
    type: 'textarea',
    controlProps: {
      // ✅ 编辑器会提示 UTextarea 的所有属性
      rows: 5,
      maxlength: 500
    }
  }),

  rating: afz.number({
    type: 'starRating',
    controlProps: {
      // ✅ 自动提示 StarRating 组件的属性
      max: 5,
      size: 'lg'
    }
  })
})
```

::tip{icon="i-lucide-zap"}
**类型推导的优势**
- 拼写错误被立即捕获
- 无需查文档也能知道某控件支持哪些属性
- IDE 自动完成加速开发
- 代码重构时得到类型安全的保障
::

### 简写语法

对于简单的错误消息，可以直接传入字符串：

```ts
const schema = afz.object({
  // 完整写法
  username: afz.string({ error: '请输入用户名' }),

  // 简写等效
  email: afz.email('请输入有效的邮箱地址')
})
```

## API

### Props

:component-props{slug=MAutoForm}

### Slots

:component-slots{slug=MAutoForm}

### Emits

:component-emits{slug=MAutoForm}

### Expose

通过 `ref` 获取表单实例，调用内置方法：

```vue
<script setup>
const autoFormRef = ref()

// 重置表单到初始状态（包含默认值）
function handleReset() {
  autoFormRef.value?.reset()
}

// 清空表单所有字段
function handleClear() {
  autoFormRef.value?.clear()
}

// 访问内部 UForm 实例
function handleValidate() {
  autoFormRef.value?.formRef?.validate()
}
</script>

<template>
  <MAutoForm ref="autoFormRef" :schema="schema" :state="form" />
  <UButton @click="handleReset">重置</UButton>
  <UButton @click="handleClear">清空</UButton>
</template>
```

## 完整示例

```vue
<script setup lang="ts">
import type { FormSubmitEvent } from '@nuxt/ui'
import type { z } from 'zod/v4'

const { afz } = useAutoForm()
const toast = useToast()

const schema = afz.object({
  username: afz.string()
    .min(3, '用户名至少 3 个字符')
    .max(20, '用户名最多 20 个字符')
    .meta({
      label: '用户名',
      placeholder: '请输入用户名'
    }),

  email: afz.email('请输入有效的邮箱')
    .meta({ label: '邮箱' }),

  password: afz.string()
    .min(8, '密码至少 8 个字符')
    .meta({
      label: '密码',
      type: 'withPasswordToggle'
    }),

  role: afz.enum(['admin', 'user', 'guest'], {
    controlProps: {
      items: [
        { label: '管理员', value: 'admin' },
        { label: '普通用户', value: 'user' },
        { label: '访客', value: 'guest' }
      ]
    }
  }).meta({ label: '角色' }),

  subscribe: afz.boolean()
    .default(true)
    .meta({ label: '订阅邮件通知' })
})

type Schema = z.output<typeof schema>

const form = ref<Partial<Schema>>({})

async function onSubmit(event: FormSubmitEvent<Schema>) {
  toast.add({
    title: '提交成功',
    color: 'success',
    description: JSON.stringify(event.data, null, 2)
  })
}
</script>

<template>
  <MAutoForm
    :schema="schema"
    :state="form"
    @submit="onSubmit"
  />
</template>
```

## 下一步

::card-group
  ::card{title="字段类型详解" icon="i-lucide-list" to="/docs/auto-form/field-types"}
  了解所有支持的字段类型及其配置方式
  ::
  ::card{title="布局系统" icon="i-lucide-layout-grid" to="/docs/auto-form/layout"}
  学习如何创建复杂的表单布局
  ::
  ::card{title="进阶功能" icon="i-lucide-zap" to="/docs/auto-form/advanced"}
  条件渲染、依赖联动等高级特性
  ::
::
